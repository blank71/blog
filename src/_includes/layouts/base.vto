<!DOCTYPE html>

<html lang="{{ it.lang }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      {{ it.title || metas.title }}{{ if it.description }}
        - {{ it.description }}{{ /if }} | {{ metas.site }}
    </title>

    <meta name="supported-color-schemes" content="light dark">
    <meta
      name="theme-color"
      content="hsl(220, 20%, 100%)"
      media="(prefers-color-scheme: light)"
    >
    <meta
      name="theme-color"
      content="hsl(220, 20%, 10%)"
      media="(prefers-color-scheme: dark)"
    >

    <link rel="me" href="https://fedibird.com/@blank71">
    {{# <link rel="stylesheet" href="/style.css"> #}}
    <link rel="stylesheet" href="/styles.css">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.css"
    >
    <link
      rel="alternate"
      href="/feed.xml"
      type="application/atom+xml"
      title="{{ metas.site }}"
    >
    <link
      rel="alternate"
      href="/feed.json"
      type="application/json"
      title="{{ metas.site }}"
    >
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
    <link rel="canonical" href="{{ url |> url(true) }}">
    {{ it.extra_head?.join("\n") }}
  </head>
  <body>
    <nav class="navbar">
      <a href="/" class="navbar-home">
        {{ if it.logo }}
          {{ it.logo }}
        {{ else }}
          <strong>{{ metas.site }}</strong>
        {{ /if }}
      </a>

      <ul class="navbar-links">
        {{- for entry of search.pages("menu.visible=true", "menu.order") }}
          <li>
            <a
              href="{{ entry.url }}"
              {{ if entry.url == url }}
                aria-current="page"{{ /if }}
            >
              {{ entry.menu.title || entry.title }}
            </a>
          </li>
        {{ /for }}
        {{- for link of it.menu_links }}
          <li>
            <a
              href="{{ link.href }}"
              {{ if link.target }}
                target="{{ link.target }}"{{ /if }}
            >
              {{ link.text }}
            </a>
          </li>
        {{ /for }}
        <li>
          <script>
            let theme = localStorage.getItem("theme") ||
              (window.matchMedia("(prefers-color-scheme: dark)")
                  .matches
                ? "dark"
                : "light");
            document.documentElement.dataset.theme = theme;
            function changeTheme() {
              theme = theme === "dark" ? "light" : "dark";
              localStorage.setItem("theme", theme);
              document.documentElement.dataset.theme = theme;
            }
          </script>
          <button class="button" onclick="changeTheme()">
            <span class="icon">◐</span>
          </button>
        </li>
      </ul>
    </nav>

    <main class="{{ it.bodyClass }}">
      {{ content }}
    </main>

    <!-- Code copy button script -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Extract filename from class attribute and add as header element
        document.querySelectorAll("pre > code[class*='filename']")
          .forEach(
            (code) => {
              const classes = code.className;
              const filenameMatch = classes.match(/filename="([^"]+)"/);
              if (filenameMatch) {
                const filename = filenameMatch[1];
                const pre = code.parentElement;

                // Create filename header
                const header = document.createElement("div");
                header.className = "code-filename";
                header.textContent = filename;

                // Insert header before pre element
                pre.parentElement.insertBefore(header, pre);

                // Add class to pre for styling
                pre.classList.add("has-filename");
              }
            },
          );

        // Add copy button to code blocks
        document.querySelectorAll("pre:has(> code.hljs)").forEach(
          (pre) => {
            const button = document.createElement("button");
            button.className = "code-copy-button";
            button.setAttribute("aria-label", "Copy code to clipboard");

            // Copy icon SVG
            const copyIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 4V2C5 1.44772 5.44772 1 6 1H13C13.5523 1 14 1.44772 14 2V10C14 10.5523 13.5523 11 13 11H11V13C11 13.5523 10.5523 14 10 14H3C2.44772 14 2 13.5523 2 13V5C2 4.44772 2.44772 4 3 4H5ZM5 5H3V13H10V11H6C5.44772 11 5 10.5523 5 10V5ZM6 2V10H13V2H6Z" fill="currentColor"/>
            </svg>`;
            
            // Check icon SVG
            const checkIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.5 3L6 11L2.5 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`;

            button.innerHTML = copyIcon;

            button.addEventListener("click", async () => {
              const code = pre.querySelector("code").textContent;
              try {
                await navigator.clipboard.writeText(code);
                button.innerHTML = checkIcon;
                setTimeout(() => {
                  button.innerHTML = copyIcon;
                }, 2000);
              } catch (err) {
                console.error("Failed to copy:", err);
                button.textContent = "✕";
                setTimeout(() => {
                  button.innerHTML = copyIcon;
                }, 2000);
              }
            });

            pre.style.position = "relative";
            pre.appendChild(button);
          },
        );
      });
    </script>

    <!-- Current page: {{ url }} -->
  </body>
</html>
